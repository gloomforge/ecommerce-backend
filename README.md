# E-commerce Backend

Backend-сервер для интернет-магазина, реализованный на [NestJS](https://nestjs.com/) с использованием [Prisma ORM](https://www.prisma.io/), MySQL и Redis.

## Возможности

- Регистрация и аутентификация пользователей
- Роли пользователей (админ, пользователь)
- Управление товарами (CRUD) # еще дорабатывается
- Управление категориями товаров
- Корзина пользователя (добавление, удаление, изменение количества)
- Сессии и хранение корзины между сессиями
- Защита эндпоинтов по ролям
- Хранение изображений товаров и категорий
- Интеграция с MySQL и Redis

## Структура проекта

- `src/auth` — аутентификация, регистрация, сессии, декораторы и guard'ы
- `src/user` — управление пользователями
- `src/product` — управление товарами, изображения товаров
- `src/category` — управление категориями, изображения категорий
- `src/cart-item` — корзина пользователя
- `src/prisma` — интеграция с Prisma ORM
- `prisma/schema.prisma` — описание моделей БД

## Основные модели (Prisma)

- **User** — пользователь (email, пароль, роль)
- **Product** — товар (название, описание, цена, изображения, категория)
- **Category** — категория товара (название, изображения)
- **CartItem** — элемент корзины (пользователь, товар, количество)

## Основные эндпоинты

- `POST /auth/register` — регистрация
- `POST /auth/login` — вход
- `POST /auth/logout` — выход
- `GET /user/me` — информация о текущем пользователе
- `PATCH /user` — обновление профиля
- `GET /product` — список товаров
- `GET /product/:id` — информация о товаре
- `POST /product` — создать товар (админ)
- `PATCH /product/:id` — обновить товар (админ)
- `DELETE /product/:id` — удалить товар (админ)
- `GET /category` — список категорий
- `POST /category` — создать категорию (админ)
- `PATCH /category/:id` — обновить категорию (админ)
- `DELETE /category/:id` — удалить категорию (админ)
- `GET /cart-item` — получить корзину пользователя
- `POST /cart-item` — добавить товар в корзину
- `PATCH /cart-item/:id` — изменить количество
- `DELETE /cart-item/:id` — удалить из корзины

## Переменные окружения

См. `.env.example` для полного списка и примера заполнения.

## Быстрый старт

### 1. Клонируйте репозиторий и перейдите в папку проекта

```bash
git clone https://github.com/gloomforge/ecommerce-backend.git
cd ecommerce-backend/
```

### 2. Скопируйте и настройте переменные окружения

```bash
cp .env.example .env
```

Откройте `.env` и укажите свои значения для MySQL, Redis, секретов сессий и других параметров.

### 3. Запустите инфраструктуру (БД и Redis) через Docker

```bash
docker-compose up -d
```

### 4. Установите зависимости

```bash
bun install
```
или
```bash
npm install
```
(в зависимости от вашего пакетного менеджера)

### 5. Примените миграции и сгенерируйте Prisma Client

```bash
npx prisma generate
npx prisma migrate deploy
```

### 6. Запустите сервер

**Рекомендуется:**  
Используйте Makefile для автоматизации всех шагов:

```bash
make
```
Это автоматически установит зависимости, поднимет контейнеры и запустит сервер в режиме разработки.

**Или вручную:**

```bash
bun run start:dev
```
или
```bash
npm run start:dev
```

---

### Быстрый старт в одну команду

Если у вас установлен `make` и Docker, просто выполните:

```bash
make
```

---

**Теперь сервер будет доступен по адресу:**  
[http://localhost:3000](http://localhost:3000) (или порт из переменной окружения)

---

**Если что-то не работает — проверьте логи контейнеров и сервера, а также корректность переменных в `.env`.**

---

## Makefile

- `make install` — установка зависимостей
- `make up` — запуск docker-compose (БД и Redis)
- `make dev` — запуск сервера в режиме разработки
- `make` — полный цикл: install + up + dev

---

## Тестирование

- Для запуска тестов используйте:

```bash
bun test
```
или
```bash
npm test
```

---

## Лицензия

Проект распространяется под лицензией [MIT](https://opensource.org/licenses/MIT).

Вы можете свободно использовать, копировать, изменять и распространять этот код для любых целей, при условии сохранения уведомления об авторских правах и лицензии в исходных файлах.
